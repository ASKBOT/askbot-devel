<!DOCTYPE html>
<html>
<head>
    <title>Asterisk Emphasis Plugin Test</title>
    <style>
        .test-case { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .pass { background-color: #dfd; }
        .fail { background-color: #fdd; }
        .input { font-family: monospace; background: #f5f5f5; padding: 5px; }
        .expected, .actual { margin-top: 10px; }
        pre { white-space: pre-wrap; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Asterisk Emphasis Plugin Test</h1>
    <p>This plugin enables code-friendly mode: asterisk emphasis works, underscore emphasis is disabled.</p>
    <div id="results"></div>

    <script src="../vendor/markdown-it.min.js"></script>
    <script src="asterisk_emphasis.js"></script>
    <script>
        var md = window.markdownit().use(window.markdownitAsteriskEmphasis);

        // Test cases with expected output (matching Python backend)
        var testCases = [
            {
                name: 'Asterisk italic works',
                input: 'This is *italic* text',
                expectedContains: ['<em>italic</em>']
            },
            {
                name: 'Asterisk bold works',
                input: 'This is **bold** text',
                expectedContains: ['<strong>bold</strong>']
            },
            {
                name: 'Underscore italic DISABLED',
                input: 'This is _not italic_ text',
                expectedNotContains: ['<em>'],
                expectedContains: ['_not italic_']
            },
            {
                name: 'Underscore bold DISABLED',
                input: 'This is __not bold__ text',
                expectedNotContains: ['<strong>'],
                expectedContains: ['__not bold__']
            },
            {
                name: 'snake_case preserved',
                input: 'Use variable_name in your code',
                expectedNotContains: ['<em>'],
                expectedContains: ['variable_name']
            },
            {
                name: 'Multiple underscores preserved',
                input: 'some_very_long_variable_name',
                expectedNotContains: ['<em>'],
                expectedContains: ['some_very_long_variable_name']
            },
            {
                name: 'Mixed: underscore variable with asterisk emphasis',
                input: 'variable_name and *emphasized* text',
                expectedContains: [
                    'variable_name',
                    '<em>emphasized</em>'
                ],
                expectedNotContains: ['<em>name']
            },
            {
                name: 'Mixed: bold and variable',
                input: 'Use **important** function_call here',
                expectedContains: [
                    '<strong>important</strong>',
                    'function_call'
                ]
            },
            {
                name: 'Nested emphasis with asterisks',
                input: '***bold and italic***',
                expectedContains: ['<strong>', '<em>']
            },
            {
                name: 'Mid-word asterisk emphasis',
                input: 'un*frigging*believable',
                expectedContains: ['<em>frigging</em>']
            },
            {
                name: 'Multiple emphasis in one line',
                input: '*one* and *two* and **three**',
                expectedContains: [
                    '<em>one</em>',
                    '<em>two</em>',
                    '<strong>three</strong>'
                ]
            },
            {
                name: 'Unmatched asterisks remain literal',
                input: 'a * b * c (spaced)',
                expectedNotContains: ['<em>']
            },
            {
                name: 'Double underscore in identifier',
                input: '__init__ method and __name__ variable',
                expectedNotContains: ['<strong>'],
                expectedContains: ['__init__', '__name__']
            }
        ];

        var resultsDiv = document.getElementById('results');
        var passCount = 0;
        var failCount = 0;

        testCases.forEach(function(tc) {
            var output = md.render(tc.input);
            var passed = true;
            var failureReasons = [];

            // Check expectedContains
            if (tc.expectedContains) {
                tc.expectedContains.forEach(function(expected) {
                    if (output.indexOf(expected) === -1) {
                        passed = false;
                        failureReasons.push('Missing: ' + expected);
                    }
                });
            }

            // Check expectedNotContains
            if (tc.expectedNotContains) {
                tc.expectedNotContains.forEach(function(notExpected) {
                    if (output.indexOf(notExpected) !== -1) {
                        passed = false;
                        failureReasons.push('Should NOT contain: ' + notExpected);
                    }
                });
            }

            if (passed) passCount++;
            else failCount++;

            var div = document.createElement('div');
            div.className = 'test-case ' + (passed ? 'pass' : 'fail');
            div.innerHTML = '<h3>' + (passed ? '✓' : '✗') + ' ' + tc.name + '</h3>' +
                '<div class="input"><strong>Input:</strong> <code>' + tc.input.replace(/</g, '&lt;') + '</code></div>' +
                '<div class="actual"><strong>Output:</strong><pre>' + output.replace(/</g, '&lt;') + '</pre></div>' +
                (failureReasons.length ? '<div class="errors"><strong>Failures:</strong><ul>' +
                    failureReasons.map(function(r) { return '<li>' + r + '</li>'; }).join('') +
                '</ul></div>' : '');
            resultsDiv.appendChild(div);
        });

        // Summary
        var summary = document.createElement('div');
        summary.innerHTML = '<h2>Summary: ' + passCount + ' passed, ' + failCount + ' failed</h2>';
        resultsDiv.insertBefore(summary, resultsDiv.firstChild);
    </script>
</body>
</html>
